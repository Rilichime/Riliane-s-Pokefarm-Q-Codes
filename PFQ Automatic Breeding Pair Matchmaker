// ==UserScript==
// @name         PFQ Auto Match Finder
// @namespace    http://tampermonkey.net/
// @version      2.1
// @description  Compare PFQ Pok√©mon in fields and show matches in other people's fields.
// @match        https://pokefarm.com/fields*
// @grant        none
// @icon         https://cdn-icons-png.flaticon.com/128/5091/5091398.png
// ==/UserScript==

(function () {
    'use strict';

    const STORAGE_KEY = 'pfq_saved_fields_data';
    const isOwnField = window.location.pathname === '/fields';

    const Gender = {
        Male: "M",
        Female: "F"
    };

    const EVOLUTION_MAPPING = {
    Bulbasaur: "Bulbasaur",
    Ivysaur: "Bulbasaur",
    Venusaur: "Bulbasaur",
    Charmander: "Charmander",
    Charmeleon: "Charmander",
    Charizard: "Charmander",
    Squirtle: "Squirtle",
    Wartortle: "Squirtle",
    Blastoise: "Squirtle",
    Caterpie: "Caterpie",
    Metapod: "Caterpie",
    Butterfree: "Caterpie",
    Weedle: "Weedle",
    Kakuna: "Weedle",
    Beedrill: "Weedle",
    Pidgey: "Pidgey",
    Pidgeotto: "Pidgey",
    Pidgeot: "Pidgey",
    Rattata: "Rattata",
    Raticate: "Rattata",
    Spearow: "Spearow",
    Fearow: "Spearow",
    Ekans: "Ekans",
    Arbok: "Ekans",
    Pichu: "Pichu",
    Pikachu: "Pichu",
    Raichu: "Pichu",
    Sandshrew: "Sandshrew",
    Sandslash: "Sandshrew",
    Nidoran: "Nidoran",
    Nidorina: "Nidoran",
    Nidoqueen: "Nidoran",
    Nidorino: "Nidoran",
    Nidoking: "Nidoran",
    Cleffa: "Cleffa",
    Clefairy: "Cleffa",
    Clefable: "Cleffa",
    Vulpix: "Vulpix",
    Ninetales: "Vulpix",
    Igglybuff: "Igglybuff",
    Jigglypuff: "Igglybuff",
    Wigglytuff: "Igglybuff",
    Zubat: "Zubat",
    Golbat: "Zubat",
    Crobat: "Zubat",
    Oddish: "Oddish",
    Gloom: "Oddish",
    Vileplume: "Oddish",
    Bellossom: "Oddish",
    Paras: "Paras",
    Parasect: "Paras",
    Venonat: "Venonat",
    Venomoth: "Venonat",
    Diglett: "Diglett",
    Dugtrio: "Diglett",
    Meowth: "Meowth",
    Persian: "Meowth",
    Psyduck: "Psyduck",
    Golduck: "Psyduck",
    Mankey: "Mankey",
    Primeape: "Mankey",
    Growlithe: "Growlithe",
    Arcanine: "Growlithe",
    Poliwag: "Poliwag",
    Poliwhirl: "Poliwag",
    Poliwrath: "Poliwag",
    Politoed: "Poliwag",
    Abra: "Abra",
    Kadabra: "Abra",
    Alakazam: "Abra",
    Machop: "Machop",
    Machoke: "Machop",
    Machamp: "Machop",
    Bellsprout: "Bellsprout",
    Weepinbell: "Bellsprout",
    Victreebel: "Bellsprout",
    Tentacool: "Tentacool",
    Tentacruel: "Tentacool",
    Geodude: "Geodude",
    Graveler: "Geodude",
    Golem: "Geodude",
    Ponyta: "Ponyta",
    Rapidash: "Ponyta",
    Slowpoke: "Slowpoke",
    Slowbro: "Slowpoke",
    Slowking: "Slowpoke",
    "Farfetch'd": "Farfetch'd",
    Doduo: "Doduo",
    Dodrio: "Doduo",
    Seel: "Seel",
    Dewgong: "Seel",
    Grimer: "Grimer",
    Muk: "Grimer",
    Shellder: "Shellder",
    Cloyster: "Shellder",
    Gastly: "Gastly",
    Haunter: "Gastly",
    Gengar: "Gastly",
    Onix: "Onix",
    Steelix: "Onix",
    Drowzee: "Drowzee",
    Hypno: "Drowzee",
    Krabby: "Krabby",
    Kingler: "Krabby",
    Exeggcute: "Exeggcute",
    Exeggutor: "Exeggcute",
    Cubone: "Cubone",
    Marowak: "Cubone",
    Lickitung: "Lickitung",
    Lickilicky: "Lickitung",
    Koffing: "Koffing",
    Weezing: "Koffing",
    Rhyhorn: "Rhyhorn",
    Rhydon: "Rhyhorn",
    Rhyperior: "Rhyhorn",
    Tangela: "Tangela",
    Tangrowth: "Tangela",
    Horsea: "Horsea",
    Seadra: "Horsea",
    Kingdra: "Horsea",
    Goldeen: "Goldeen",
    Seaking: "Goldeen",
    Scyther: "Scyther",
    Scizor: "Scyther",
    Pinsir: "Pinsir",
    Magikarp: "Magikarp",
    Gyarados: "Magikarp",
    Lapras: "Lapras",
    Eevee: "Eevee",
    Vaporeon: "Eevee",
    Jolteon: "Eevee",
    Flareon: "Eevee",
    Espeon: "Eevee",
    Umbreon: "Eevee",
    Leafeon: "Eevee",
    Glaceon: "Eevee",
    Sylveon: "Eevee",
    Omanyte: "Omanyte",
    Omastar: "Omanyte",
    Kabuto: "Kabuto",
    Kabutops: "Kabuto",
    Aerodactyl: "Aerodactyl",
    Munchlax: "Munchlax",
    Snorlax: "Munchlax",
    Chikorita: "Chikorita",
    Bayleef: "Chikorita",
    Meganium: "Chikorita",
    Cyndaquil: "Cyndaquil",
    Quilava: "Cyndaquil",
    Typhlosion: "Cyndaquil",
    Totodile: "Totodile",
    Croconaw: "Totodile",
    Feraligator: "Totodile",
    Sentret: "Sentret",
    Furret: "Sentret",
    Hoothoot: "Hoothoot",
    Noctowl: "Hoothoot",
    Ledyba: "Ledyba",
    Ledian: "Ledyba",
    Spinarak: "Spinarak",
    Ariados: "Spinarak",
    Chinchou: "Chinchou",
    Lanturn: "Chinchou",
    Togepi: "Togepi",
    Togetic: "Togepi",
    Togekiss: "Togepi",
    Natu: "Natu",
    Xatu: "Natu",
    Mareep: "Mareep",
    Flaaffy: "Mareep",
    Ampharos: "Mareep",
    Azurill: "Azurill",
    Marill: "Azurill",
    Azumarill: "Azurill",
    Bonsly: "Bonsly",
    Sudowoodo: "Bonsly",
    Hoppip: "Hoppip",
    Skiploom: "Hoppip",
    Jumpluff: "Hoppip",
    Aipom: "Aipom",
    Ambipom: "Aipom",
    Sunkern: "Sunkern",
    Sunflora: "Sunkern",
    Yanma: "Yanma",
    Yanmega: "Yanma",
    Wooper: "Wooper",
    Quagsire: "Wooper",
    Murkrow: "Murkrow",
    Honchkrow: "Murkrow",
    Misdreavus: "Misdreavus",
    Mismagius: "Misdreavus",
    Girafarig: "Girafarig",
    Pineco: "Pineco",
    Forretress: "Pineco",
    Dunsparce: "Dunsparce",
    Gligar: "Gligar",
    Gliscor: "Gligar",
    Snubbull: "Snubbull",
    Granbull: "Snubbull",
    Qwilfish: "Qwilfish",
    Shuckle: "Shuckle",
    Heracross: "Heracross",
    Sneasel: "Sneasel",
    Weavile: "Sneasel",
    Teddiursa: "Teddiursa",
    Ursaring: "Teddiursa",
    Slugma: "Slugma",
    Magcargo: "Slugma",
    Swinub: "Swinub",
    Piloswine: "Swinub",
    Mamoswine: "Swinub",
    Corsola: "Corsola",
    Remoraid: "Remoraid",
    Octillery: "Remoraid",
    Delibird: "Delibird",
    Skarmory: "Skarmory",
    Houndour: "Houndour",
    Houndoom: "Houndour",
    Phanpy: "Phanpy",
    Donphan: "Phanpy",
    Stantler: "Stantler",
    Smeargle: "Smeargle",
    Elekid: "Elekid",
    Electabuzz: "Elekid",
    Electivire: "Elekid",
    Magby: "Magby",
    Magmar: "Magby",
    Magmortar: "Magby",
    Larvitar: "Larvitar",
    Pupitar: "Larvitar",
    Tyranitar: "Larvitar",
    Unown: "Unown",
    Treecko: "Treecko",
    Grovyle: "Treecko",
    Sceptile: "Treecko",
    Torchic: "Torchic",
    Combusken: "Torchic",
    Blaziken: "Torchic",
    Mudkip: "Mudkip",
    Marshtomp: "Mudkip",
    Swampert: "Mudkip",
    Poochyena: "Poochyena",
    Mightyena: "Poochyena",
    Zigzagoon: "Zigzagoon",
    Linoone: "Zigzagoon",
    Wurmple: "Wurmple",
    Silcoon: "Wurmple",
    Beautifly: "Wurmple",
    Cascoon: "Wurmple",
    Dustox: "Wurmple",
    Lotad: "Lotad",
    Lombre: "Lotad",
    Ludicolo: "Lotad",
    Seedot: "Seedot",
    Nuzleaf: "Seedot",
    Shiftry: "Seedot",
    Taillow: "Taillow",
    Swellow: "Taillow",
    Wingull: "Wingull",
    Pelipper: "Wingull",
    Ralts: "Ralts",
    Kirlia: "Ralts",
    Gardevoir: "Ralts",
    Gallade: "Ralts",
    Surskit: "Surskit",
    Masquerain: "Surskit",
    Shroomish: "Shroomish",
    Breloom: "Shroomish",
    Slakoth: "Slakoth",
    Vigoroth: "Slakoth",
    Slaking: "Slakoth",
    Nincada: "Nincada",
    Ninjask: "Nincada",
    Shedinja: "Nincada",
    Whismur: "Whismur",
    Loudred: "Whismur",
    Exploud: "Whismur",
    Makuhita: "Makuhita",
    Hariyama: "Makuhita",
    Nosepass: "Nosepass",
    Probopass: "Nosepass",
    Skitty: "Skitty",
    Delcatty: "Skitty",
    Sableye: "Sableye",
    Mawile: "Mawile",
    Aron: "Aron",
    Lairon: "Aron",
    Aggron: "Aron",
    Meditite: "Meditite",
    Medicham: "Meditite",
    Electrike: "Electrike",
    Manectric: "Electrike",
    Plusle: "Plusle",
    Minun: "Minun",
    Gulpin: "Gulpin",
    Swalot: "Gulpin",
    Carvanha: "Carvanha",
    Sharpedo: "Carvanha",
    Wailmer: "Wailmer",
    Wailord: "Wailmer",
    Numel: "Numel",
    Camerupt: "Numel",
    Torkoal: "Torkoal",
    Spoink: "Spoink",
    Grumpig: "Spoink",
    Spinda: "Spinda",
    Trapinch: "Trapinch",
    Vibrava: "Trapinch",
    Flygon: "Trapinch",
    Cacnea: "Cacnea",
    Cacturne: "Cacnea",
    Swablu: "Swablu",
    Altaria: "Swablu",
    Zangoose: "Zangoose",
    Seviper: "Seviper",
    Barboach: "Barboach",
    Whiscash: "Barboach",
    Corphish: "Corphish",
    Crawdaunt: "Corphish",
    Lileep: "Lileep",
    Cradily: "Lileep",
    Anorith: "Anorith",
    Armaldo: "Anorith",
    Feebas: "Feebas",
    Milotic: "Feebas",
    Castform: "Castform",
    Kecleon: "Kecleon",
    Shuppet: "Shuppet",
    Banette: "Shuppet",
    Duskull: "Duskull",
    Dusclops: "Duskull",
    Dusknoir: "Duskull",
    Tropius: "Tropius",
    Chingling: "Chingling",
    Chimecho: "Chingling",
    Absol: "Absol",
    Wynaut: "Wynaut",
    Wobbuffet: "Wobbuffet",
    Snorunt: "Snorunt",
    Glalie: "Snorunt",
    Froslass: "Snorunt",
    Spheal: "Spheal",
    Sealeo: "Spheal",
    Walrein: "Spheal",
    Clamperl: "Clamperl",
    Huntail: "Clamperl",
    Gorebyss: "Clamperl",
    Relicanth: "Relicanth",
    Luvdisc: "Luvdisc",
    Bagon: "Bagon",
    Shelgon: "Bagon",
    Salamence: "Bagon",
    Turtwig: "Turtwig",
    Grotle: "Turtwig",
    Torterra: "Turtwig",
    Chimchar: "Chimchar",
    Monferno: "Chimchar",
    Infernape: "Chimchar",
    Piplup: "Piplup",
    Prinplup: "Piplup",
    Empoleon: "Piplup",
    Starly: "Starly",
    Staravia: "Starly",
    Staraptor: "Starly",
    Bidoof: "Bidoof",
    Bibarel: "Bidoof",
    Kricketot: "Kricketot",
    Kricketune: "Kricketot",
    Shinx: "Shinx",
    Luxio: "Shinx",
    Luxray: "Shinx",
    Budew: "Budew",
    Roselia: "Budew",
    Roserade: "Budew",
    Cranidos: "Cranidos",
    Rampardos: "Cranidos",
    Shieldon: "Shieldon",
    Bastiodon: "Shieldon",
    Burmy: "Burmy",
    Wormadam: "Burmy",
    Mothim: "Burmy",
    Combee: "Combee",
    Pachirisu: "Pachirisu",
    Buizel: "Buizel",
    Floatzel: "Buizel",
    Cherubi: "Cherubi",
    Cherrim: "Cherubi",
    Shellos: "Shellos",
    Gastrodon: "Shellos",
    Drifloon: "Drifloon",
    Drifblim: "Drifloon",
    Buneary: "Buneary",
    Lopunny: "Buneary",
    Glameow: "Glameow",
    Purugly: "Glameow",
    Stunky: "Stunky",
    Skuntank: "Stunky",
    Chatot: "Chatot",
    Spiritomb: "Spiritomb",
    Gible: "Gible",
    Gabite: "Gible",
    Garchomp: "Gible",
    Riolu: "Riolu",
    Lucario: "Riolu",
    Hippopotas: "Hippopotas",
    Hippowdon: "Hippopotas",
    Skorupi: "Skorupi",
    Drapion: "Skorupi",
    Croagunk: "Croagunk",
    Toxicroak: "Croagunk",
    Carnivine: "Carnivine",
    Finneon: "Finneon",
    Lumineon: "Finneon",
    Mantyke: "Mantyke",
    Mantine: "Mantyke",
    Snover: "Snover",
    Abomasnow: "Snover",
    Wyrdeer: "Stantler",
    Kleavor: "Scyther",
    Ursaluna: "Teddiursa",
    Basculegion: "Basculin",
    Sneasler: "Sneasel",
    Overqwil: "Qwilfish",
    Snivy: "Snivy",
    Servine: "Snivy",
    Serperior: "Snivy",
    Tepig: "Tepig",
    Pignite: "Tepig",
    Emboar: "Tepig",
    Oshawott: "Oshawott",
    Dewott: "Oshawott",
    Samurott: "Oshawott",
    Patrat: "Patrat",
    Watchog: "Patrat",
    Lillipup: "Lillipup",
    Herdier: "Lillipup",
    Stoutland: "Lillipup",
    Purrloin: "Purrloin",
    Liepard: "Purrloin",
    Pansage: "Pansage",
    Simisage: "Pansage",
    Pansear: "Pansear",
    Simisear: "Pansear",
    Panpour: "Panpour",
    Simipour: "Panpour",
    Munna: "Munna",
    Musharna: "Munna",
    Pidove: "Pidove",
    Tranquill: "Pidove",
    Unfezant: "Pidove",
    Blitzle: "Blitzle",
    Zebstrika: "Blitzle",
    Roggenrola: "Roggenrola",
    Boldore: "Roggenrola",
    Gigalith: "Roggenrola",
    Woobat: "Woobat",
    Swoobat: "Woobat",
    Drilbur: "Drilbur",
    Excadrill: "Drilbur",
    Audino: "Audino",
    Tympole: "Tympole",
    Palpitoad: "Tympole",
    Seismitoad: "Tympole",
    Sewaddle: "Sewaddle",
    Swadloon: "Sewaddle",
    Leavanny: "Sewaddle",
    Venipede: "Venipede",
    Whirlipede: "Venipede",
    Scolipede: "Venipede",
    Cottonee: "Cottonee",
    Whimsicott: "Cottonee",
    Basculin: "Basculin",
    Sandile: "Sandile",
    Krokorok: "Sandile",
    Krookodile: "Sandile",
    Darumaka: "Darumaka",
    Darmanitan: "Darumaka",
    Maractus: "Maractus",
    Dwebble: "Dwebble",
    Crustle: "Dwebble",
    Scraggy: "Scraggy",
    Scrafty: "Scraggy",
    Sigilyph: "Sigilyph",
    Yamask: "Yamask",
    Cofagrigus: "Yamask",
    Tirtouga: "Tirtouga",
    Carracosta: "Tirtouga",
    Archen: "Archen",
    Archeops: "Archen",
    Trubbish: "Trubbish",
    Garbodor: "Trubbish",
    Zorua: "Zorua",
    Zoroark: "Zorua",
    Minccino: "Minccino",
    Cinccino: "Minccino",
    Gothita: "Gothita",
    Gothorita: "Gothita",
    Gothitelle: "Gothita",
    Solosis: "Solosis",
    Duosion: "Solosis",
    Reuniclus: "Solosis",
    Ducklett: "Ducklett",
    Swanna: "Ducklett",
    Vanillite: "Vanillite",
    Vanillish: "Vanillite",
    Vanilluxe: "Vanillite",
    Deerling: "Deerling",
    Sawsbuck: "Deerling",
    Emolga: "Emolga",
    Karrablast: "Karrablast",
    Escavalier: "Karrablast",
    Foongus: "Foongus",
    Amoonguss: "Foongus",
    Frillish: "Frillish",
    Jellicent: "Frillish",
    Alomomola: "Alomomola",
    Joltik: "Joltik",
    Galvantula: "Joltik",
    Ferroseed: "Ferroseed",
    Ferrothorn: "Ferroseed",
    Tynamo: "Tynamo",
    Eelektrik: "Tynamo",
    Eelektross: "Tynamo",
    Elgyem: "Elgyem",
    Beheeyem: "Elgyem",
    Litwick: "Litwick",
    Lampent: "Litwick",
    Chandelure: "Litwick",
    Axew: "Axew",
    Fraxure: "Axew",
    Haxorus: "Axew",
    Cubchoo: "Cubchoo",
    Beartic: "Cubchoo",
    Shelmet: "Shelmet",
    Accelgor: "Shelmet",
    Stunfisk: "Stunfisk",
    Mienfoo: "Mienfoo",
    Mienshao: "Mienfoo",
    Druddigon: "Druddigon",
    Pawniard: "Pawniard",
    Bisharp: "Pawniard",
    Bouffalant: "Bouffalant",
    Rufflet: "Rufflet",
    Braviary: "Rufflet",
    Vullaby: "Vullaby",
    Mandibuzz: "Vullaby",
    Heatmor: "Heatmor",
    Durant: "Durant",
    Deino: "Deino",
    Zweilous: "Deino",
    Hydreigon: "Deino",
    Larvesta: "Larvesta",
    Volcarona: "Larvesta",
    Chespin: "Chespin",
    Quilladin: "Chespin",
    Chesnaught: "Chespin",
    Fennekin: "Fennekin",
    Braixen: "Fennekin",
    Delphox: "Fennekin",
    Froakie: "Froakie",
    Frogadier: "Froakie",
    Greninja: "Froakie",
    Bunnelby: "Bunnelby",
    Diggersby: "Bunnelby",
    Fletchling: "Fletchling",
    Fletchinder: "Fletchling",
    Talonflame: "Fletchling",
    Scatterbug: "Scatterbug",
    Spewpa: "Scatterbug",
    Vivillon: "Scatterbug",
    Litleo: "Litleo",
    Pyroar: "Litleo",
    Skiddo: "Skiddo",
    Gogoat: "Skiddo",
    Pancham: "Pancham",
    Pangoro: "Pancham",
    Furfrou: "Furfrou",
    Espurr: "Espurr",
    Meowstic: "Espurr",
    Honedge: "Honedge",
    Doublade: "Honedge",
    Aegislash: "Honedge",
    Spritzee: "Spritzee",
    Aromatisse: "Spritzee",
    Swirlix: "Swirlix",
    Slurpuff: "Swirlix",
    Inkay: "Inkay",
    Malamar: "Inkay",
    Binacle: "Binacle",
    Barbaracle: "Binacle",
    Skrelp: "Skrelp",
    Dragalge: "Skrelp",
    Clauncher: "Clauncher",
    Clawitzer: "Clauncher",
    Helioptile: "Helioptile",
    Heliolisk: "Helioptile",
    Tyrunt: "Tyrunt",
    Tyrantrum: "Tyrunt",
    Amaura: "Amaura",
    Aurorus: "Amaura",
    Hawlucha: "Hawlucha",
    Dedenne: "Dedenne",
    Goomy: "Goomy",
    Sliggoo: "Goomy",
    Goodra: "Goomy",
    Klefki: "Klefki",
    Phantump: "Phantump",
    Trevenant: "Phantump",
    Pumpkaboo: "Pumpkaboo",
    Gourgeist: "Pumpkaboo",
    Bergmite: "Bergmite",
    Avalugg: "Bergmite",
    Noibat: "Noibat",
    Noivern: "Noibat",
    Rowlet: "Rowlet",
    Dartrix: "Rowlet",
    Decidueye: "Rowlet",
    Litten: "Litten",
    Torracat: "Litten",
    Incineroar: "Litten",
    Popplio: "Popplio",
    Brionne: "Popplio",
    Primarina: "Popplio",
    Pikipek: "Pikipek",
    Trumbeak: "Pikipek",
    Toucannon: "Pikipek",
    Yungoos: "Yungoos",
    Gumshoos: "Yungoos",
    Grubbin: "Grubbin",
    Charjabug: "Grubbin",
    Vikavolt: "Grubbin",
    Crabrawler: "Crabrawler",
    Crabominable: "Crabrawler",
    Oricorio: "Oricorio",
    Cutiefly: "Cutiefly",
    Ribombee: "Cutiefly",
    Rockruff: "Rockruff",
    Lycanroc: "Rockruff",
    Wishiwashi: "Wishiwashi",
    Mareanie: "Mareanie",
    Toxapex: "Mareanie",
    Mudbray: "Mudbray",
    Mudsdale: "Mudbray",
    Dewpider: "Dewpider",
    Araquanid: "Dewpider",
    Fomantis: "Fomantis",
    Lurantis: "Fomantis",
    Morelull: "Morelull",
    Shiinotic: "Morelull",
    Salandit: "Salandit",
    Stufful: "Stufful",
    Bewear: "Stufful",
    Comfey: "Comfey",
    Oranguru: "Oranguru",
    Passimian: "Passimian",
    Wimpod: "Wimpod",
    Golisopod: "Wimpod",
    Sandygast: "Sandygast",
    Palossand: "Sandygast",
    Pyukumuku: "Pyukumuku",
    Komala: "Komala",
    Turtonator: "Turtonator",
    Togedemaru: "Togedemaru",
    Mimikyu: "Mimikyu",
    Bruxish: "Bruxish",
    Drampa: "Drampa",
    "Jangmo-o": "Jangmo-o",
    "Hakamo-o": "Hakamo-o",
    "Kommo-o": "Kommo-o",
    Grookey: "Grookey",
    Thwackey: "Grookey",
    Rillaboom: "Grookey",
    Scorbunny: "Scorbunny",
    Raboot: "Scorbunny",
    Cinderace: "Scorbunny",
    Sobble: "Sobble",
    Drizzile: "Sobble",
    Inteleon: "Sobble",
    Skwovet: "Skwovet",
    Greedent: "Skwovet",
    Rookidee: "Rookidee",
    Corvisquire: "Rookidee",
    Corviknight: "Rookidee",
    Blipbug: "Blipbug",
    Dottler: "Blipbug",
    Orbeetle: "Blipbug",
    Nickit: "Nickit",
    Thievul: "Nickit",
    Gossifleur: "Gossifleur",
    Eldegoss: "Gossifleur",
    Wooloo: "Wooloo",
    Dubwool: "Wooloo",
    Chewtle: "Chewtle",
    Drednaw: "Chewtle",
    Yamper: "Yamper",
    Boltund: "Yamper",
    Rolycoly: "Rolycoly",
    Carkol: "Rolycoly",
    Coalossal: "Rolycoly",
    Applin: "Applin",
    Flapple: "Applin",
    Appletun: "Applin",
    Silicobra: "Silicobra",
    Sandaconda: "Silicobra",
    Cramorant: "Cramorant",
    Arrokuda: "Arrokuda",
    Barraskewda: "Arrokuda",
    Toxel: "Toxel",
    Toxtricity: "Toxel",
    Sizzlipede: "Sizzlipede",
    Centiskorch: "Sizzlipede",
    Clobbopus: "Clobbopus",
    Grapploct: "Clobbopus",
    Obstagoon: "Zigzagoon",
    Perrserker: "Meowth",
    Cursola: "Corsola",
    "Sirfetch'd": "Sirfetch'd",
    "Mr. Rime": "Mime Jr.",
    Runerigus: "Yamask",
    Falinks: "Falinks",
    Pincurchin: "Pincurchin",
    Snom: "Snom",
    Frosmoth: "Snom",
    Stonjourner: "Stonjourner",
    Eiscue: "Eiscue",
    Indeedee: "Indeedee",
    Morpeko: "Morpeko",
    Cufant: "Cufant",
    Copperajah: "Cufant",
    Duraludon: "Duraludon",
    Dreepy: "Dreepy",
    Drakloak: "Dreepy",
    Dragapult: "Dreepy",
    Sprigatito: "Sprigatito",
    Floragato: "Sprigatito",
    Meowscarada: "Sprigatito",
    Fuecoco: "Fuecoco",
    Crocalor: "Fuecoco",
    Skeledirge: "Fuecoco",
    Quaxly: "Quaxly",
    Quaxwell: "Quaxly",
    Quaquaval: "Quaxly",
    Lechonk: "Lechonk",
    Oinkologne: "Lechonk",
    Tarountula: "Tarountula",
    Spidops: "Tarountula",
    Nymble: "Nymble",
    Lokix: "Nymble",
    Pawmi: "Pawmi",
    Pawmo: "Pawmi",
    Pawmot: "Pawmi",
    Tandemaus: "Tandemaus",
    Maushold: "Tandemaus",
    Fidough: "Fidough",
    Dachsbun: "Fidough",
    Smoliv: "Smoliv",
    Dolliv: "Smoliv",
    Arboliva: "Smoliv",
    Squawkabilly: "Squawkabilly",
    Nacli: "Nacli",
    Naclstack: "Nacli",
    Garganacl: "Nacli",
    Charcadet: "Charcadet",
    Armarouge: "Charcadet",
    Ceruledge: "Charcadet",
    Tadbulb: "Tadbulb",
    Bellibolt: "Tadbulb",
    Wattrel: "Wattrel",
    Kilowattrel: "Wattrel",
    Maschiff: "Maschiff",
    Mabosstiff: "Maschiff",
    Shroodle: "Shroodle",
    Grafaiai: "Shroodle",
    Bramblin: "Bramblin",
    Brambleghast: "Bramblin",
    Toedscool: "Toedscool",
    Toedscruel: "Toedscool",
    Klawf: "Klawf",
    Capsakid: "Capsakid",
    Scovillain: "Capsakid",
    Rellor: "Rellor",
    Rabsca: "Rellor",
    Flittle: "Flittle",
    Espathra: "Flittle",
    Wiglett: "Wiglett",
    Wugtrio: "Wiglett",
    Bombirdier: "Bombirdier",
    Finizen: "Finizen",
    Palafin: "Finizen",
    Varoom: "Varoom",
    Revavroom: "Varoom",
    Cyclizar: "Cyclizar",
    Orthworm: "Orthworm",
    Glimmet: "Glimmet",
    Glimmora: "Glimmet",
    Greavard: "Greavard",
    Houndstone: "Greavard",
    Flamigo: "Flamigo",
    Cetoddle: "Cetoddle",
    Cetitan: "Cetoddle",
    Veluza: "Veluza",
    Dondozo: "Dondozo",
    Tatsugiri: "Tatsugiri",
    Annihilape: "Mankey",
    Clodsire: "Wooper",
    Farigiraf: "Girafarig",
    Dudunsparce: "Dunsparce",
    Kingambit: "Pawniard",
    Frigibax: "Frigibax",
    Arctibax: "Frigibax",
    Baxcalibur: "Frigibax",
    Dipplin: "Applin",
    Hydrapple: "Applin",
    Archaludon: "Duraludon",
    Tyrogue: "Tyrogue",
    Hitmonchan: "Tyrogue",
    Hitmonlee: "Tyrogue",
    Hitmontop: "Tyrogue",
    Sawk: "Sawk",
    Throh: "Throh",
    Petilil: "Petilil",
    Lilligant: "Petilil",
    Flabebe: "Flabebe",
    Smoochum: "Smoochum",
    Jynx: "Smoochum",
    Miltank: "Miltank",
    Bounsweet: "Bounsweet",
    Steenee: "Bounsweet",
    Tsareena: "Bounsweet",
    Hatterem: "Hatenna",
    Hatenna: "Hatenna",
    Milcery: "Milery",
    Tinkatink: "Tinkatink",
    Impidimp: "Tyrogue",
    Caprikid: "Caprikid",
    Saytaries: "Caprikid",
    Taurminos: "Caprikid",
    Sagidamas: "Caprikid",
    Kangaskhan: "Kangaskhan",
    Babaisy: "Babaisy",
    Chamobelle: "Babaisy",
    Tauros: "Tauros",
    Happiny: "Happiny",
    Chansey: "Happiny",
    Blissey: "Happiny",
    Lunupine: "Lunupine",
    Blophin: "Blophin",
    Inflale: "Blophin",
    Orkit: "Orkit",
    Orcalot: "Orkit",
    Faemue√±o: "Faemue√±o",
    Faemilar√≠n: "Faemue√±o",
    Faem√≠simo: "Faemue√±o",
    Wagell: "Wagell",
    Wanamangora: "Wagell",
    Gosold: "Gosold",
    Goldesem: "Gosold",
    Impyre: "Impyre",
    Baflammet: "Impyre",
    Searene: "Searene",
    Solynx: "Solynx",
    Ardik: "Ardik",
    Sibex: "Ardik",
    Boxaby: "Boxaby",
    Kangspar: "Boxaby",
    Taiveret: "Taiveret",
    Taipaeus: "Taiveret",
    Taimorpha: "Taiveret",
    Flarbat: "Flarbat",
    Flarotis: "Flarbat",
    Flaroptera: "Flarbat",
    Hydrark: "Hydrark",
    Hydrinus: "Hydrark",
    Hydrinifor: "Hydrark",
    Gragon: "Gragon",
    Greegon: "Gragon",
    Avaragon: "Gragon",
    Luckoo: "Luckoo",
    Peckoo: "Luckoo",
    Peekoo: "Luckoo",
    Arasprit: "Arasprit",
    Arthreux: "Arasprit",
    Quetzephyr: "Quetzephyr",
    Quetzaptyl: "Quetzephyr",
    Pixrine: "Pixrine",
    Kitsunari: "Kitsunari",
    Kitsubuki: "Kitsunari",
    Bandicoon: "Bandicoon",
    Phastix: "Phastix",
    Phasmaleef: "Phastix",
    Pasovan: "Pasovan",
    Glaquine: "Glaquine",
    Cavallost: "Glaquine",
    Tillink: "Tillink",
    Terrink: "Tillink",
    Bezerell: "Bezerell",
    Bezermuur: "Bezerell",
    Bezermuut: "Bezerell",
    Ayeren: "Ayeren",
    Aytheraye: "Ayeren",
    Skeleco: "Skeleco",
    Phantiidae: "Skeleco",
    Klaatupillar: "Klaatupillar",
    Charaxalis: "Klaatupillar",
    Incantasius: "Klaatupillar",
    Maravol: "Maravol",
    Kyutopi: "Kyutopi",
    Konatus: "Kyutopi",
    Kenyip: "Kenyip",
    Arfrica: "Kenyip",
    Kalahowli: "Kenyip",
    Petripeep: "Petripeep",
    Chirock: "Petripeep",
    Toxitrice: "Petripeep",
    Serpetone: "Petripeep",
    Toxilisk: "Petripeep",
    Gumairy: "Gumairy",
    Eucylph: "Gumairy",
    Puppod: "Puppod",
    Slugdog: "Puppod",
    Rokiwi: "Rokiwi",
    Brushiwi: "Rokiwi",
    Alicalf: "Alicalf",
    Cetacorn: "Alicalf",
    Valkind: "Valkind",
    Frayja: "Valkind",
    Croaket: "Croaket",
    Quibbit: "Croaket",
    Slypin: "Slypin",
    Haredini: "Slypin",
    Selkrub: "Selkrub",
    Aqrabion: "Selkrub",
    Skargas: "Selkrub",
    Kawotor: "Kawotor",
    Lutriva: "Kawotor",
    Selutian: "Kawotor",
    Kitwurm: "Kitwurm",
    Purrpa: "Kitwurm",
    Moffkat: "Kitwurm",
    Pepyre: "Pepyre",
    Skarasear: "Pepyre",
    Aphreyd: "Aphreyd",
    Scavady: "Aphreyd",
    Mantidra: "Aphreyd",
    Caimaw: "Caimaw",
    Caimangle: "Caimaw",
    Valimp: "Valimp",
    Valladox: "Valimp",
    Valenoir: "Valimp",
    Frusky: "Frusky",
    Glacifur: "Frusky",
    Skyrie: "Skyrie",
    Grymphony: "Skyrie",
    Goschief: "Goschief",
    Havonk: "Goschief",
    Mocknock: "Mocknock",
    Portalgeist: "Mocknock",
    Flurrawr: "Flurrawr",
    Tundrasail: "Flurrawr",
    Parapod: "Parapod",
    Craysprout: "Parapod",
    Strelitzgon: "Parapod",
    Tenrekki: "Tenrekki",
    Possmol: "Possmol",
    Opposham: "Possmol",
    Opposkull: "Possmol",
    Exilant: "Exilant",
    Scorupt: "Exilant",
    Lyruse: "Lyruse",
    Musharp: "Lyruse",
    Smokackle: "Smokackle",
    Hycano: "Smokackle",
    Inferial: "Inferial",
    Gargodyle: "Inferial",
    Mirrasma: "Mirrasma",
    Mirrarch: "Mirrasma",
    Slithugi: "Slithugi",
    Sugikobra: "Slithugi",
    Ryumen: "Ryumen",
    Ryudon: "Ryumen",
    Schweepy: "Schweepy",
    Schwoomstick: "Schweepy",
    Cinnamoru: "Cinnamoru",
    Croissaca: "Cinnamoru",
    Quokuddle: "Quokuddle",
    Chark: "Chark",
    Sharkoal: "Chark",
    Dribbit: "Dribbit",
    Frungus: "Dribbit",
    Frogayaga: "Dribbit",
    Seistatic: "Seistatic",
    Voltaida: "Seistatic",
    Jestur: "Jestur",
    Embretta: "Embretta",
    Flaretta: "Embretta",
    Platykit: "Platykit",
    Platytank: "Platykit",
    Sugarcoatl: "Sugarcoatl",
    Canduceus: "Sugarcoatl",
    Destrel: "Destrel",
    Angroy: "Destrel",
    Humbee: "Humbee",
    Hummagona: "Humbee",
    Perroc: "Perroc",
    Tulby: "Tulby",
    Tuleer: "Tulby",
    Erminja: "Erminja",
    Shuritachi: "Erminja",
    Littail: "Littail",
    Signail: "Littail",
    Bafftoi: "Bafftoi",
    Gobistream: "Bafftoi",
    Lichoung: "Lichoung",
    Eldereen: "Lichoung",
    "Shooting Star Cleffa": "Shooting Star Cleffa",
    "Shooting Star Clefairy": "Shooting Star Cleffa",
    "Shooting Star Clefable": "Shooting Star Cleffa",
    "Apocalyptic Shroomish": "Apocalyptic Shroomish",
    "Apocalyptic Breloom": "Apocalyptic Shroomish",
    "Apocalyptic Growlithe": "Apocalyptic Growlithe",
    "Apocalyptic Arcanine": "Apocalyptic Growlithe",
    "Blue Moon Slugma": "Blue Moon Slugma",
    "Blue Moon Magcargo": "Blue Moon Slugma",
    Cactaboo: "Cactaboo",
    Geisturne: "Cactaboo",
    Deinglitch: "Deinglitch",
    Zweiglitch: "Deinglitch",
    Hydreglitch: "Deinglitch",
    "Early Bird Natu": "Early Bird Natu",
    "Early Bird Xatu": "Early Bird Natu",
    Elekimp: "Elekimp",
    Electagrem: "Elekimp",
    Electisnarl: "Elekimp",
    "Surfing Pichu": "Surfing Pichu",
    "Surfing Pikachu": "Surfing Pichu",
    "Surfing Raicchu": "Surfing Pichu",
    "Flying  Pichu": "Flying Pichu",
    "Flying Pikachu": "Flying Pichu",
    "Flying Raicchu": "Flying Pichu",
    Gibolu: "Gibolu",
    Gabolu: "Gibolu",
    Garcario: "Gibolu",
    Glileo: "Glileo",
    Pyriscor: "Glileo",
    "Guild Igglybuff": "Guild Igglybuff",
    "Guild Jigglypuff": "Guild Igglybuff",
    "Guild Wigglytuff": "Guild Igglybuff",
    Koroku: "Koroku",
    Magipede: "Magipede",
    Mystiskorch: "Magipede",
    Noismog: "Noismog",
    Noismoem: "Noismog",
    Ryukuza: "Ryukuza",
    "Saiyan Rattata": "Saiyan Rattata",
    "Saiyan Raticate": "Saiyan Rattata",
    "Seasonal Turtwig": "Seasonal Turtwig",
    "Seasonal Grotle": "Seasonal Turtwig",
    "Seasonal Torterra": "Seasonal Turtwig",
    Scaracross: "Scaracross",
    Shinxel: "Shinxel",
    Fluxio: "Shinxel",
    Fluxray: "Shinxel",
    Snichu: "Snichu",
    Vilechu: "Snichu",
    Snoralts: "Snoralts",
    Snolia: "Snoralts",
    Frosvoir: "Snoralts",
    "Snow Combee": "Snow Combee",
    Sapskit: "Sapskit",
    Grovarain: "Sapskit",
    Snowpoke: "Snowpoke",
    Snowbro: "Snowpoke",
    Snowking: "Snowpoke",
    Spritzkrow: "Spritzkrow",
    Aromakrow: "Spritzkrow",
    Teddicursa: "Teddicursa",
    Cursaring: "Teddicursa",
    Ruffwool: "Ruffwool",
    Lycanwool: "Ruffwool",
    Frosdour: "Frosour",
    Chilldoom: "Frosdour",

    };

    function getGender(tooltip) {
        if (tooltip.querySelector('img[src*="gender_m.png"]')) return Gender.Male;
        if (tooltip.querySelector('img[src*="gender_f.png"]')) return Gender.Female;
        return null;
    }

    function getFieldFromTooltip(tooltip, index) {
        const node = tooltip.childNodes[index];
        const text = node?.innerText || node?.textContent || "";
        const [_, info] = text.split(":");
        return info?.trim();
    }

    function extractNature(rawNature) {
        return rawNature.replace(/\s*\(.*?\)/, '').trim();
    }

    function getPokemonDataFromTooltip(tooltip) {
        const species = getFieldFromTooltip(tooltip, 3);
        const forme = getFieldFromTooltip(tooltip, 4) || null;
        const gender = getGender(tooltip);

        const lines = [...tooltip.querySelectorAll('div')].map(div => div.textContent.trim());
        const natureLine = lines.find(line => line.startsWith('Nature:'));
        const natureRaw = natureLine ? natureLine.split(':')[1].trim() : 'N/A';
        const nature = extractNature(natureRaw);

        const linkElement = tooltip.querySelector('a');
        const link = linkElement ? linkElement.href : null;

        return { species, forme, nature, gender, link };
    }

    function getBaseSpecies(species) {
        return EVOLUTION_MAPPING[species] || species;
    }

    function getOppositeGender(gender) {
        if (gender === Gender.Male) return Gender.Female;
        if (gender === Gender.Female) return Gender.Male;
        return null;
    }

    function matchPokemon(mon, savedList) {
        const oppositeGender = getOppositeGender(mon.gender);
        if (!oppositeGender) return null;

        const baseSpecies = getBaseSpecies(mon.species);

        return savedList.find(saved =>
            getBaseSpecies(saved.species) === baseSpecies &&
            saved.forme === mon.forme &&
            saved.nature === mon.nature &&
            saved.gender === oppositeGender
        );
    }

    function triggerTooltips() {
        const mons = document.querySelectorAll('.pokemon_class');
        mons.forEach(el => el.dispatchEvent(new Event('mouseover')));
    }

    function getCurrentFieldName() {
        const btn = document.querySelector('button[data-action="jump"]');
        if (!btn) return 'Unknown Field';
        return btn.textContent.trim();
    }

    function loadAllFieldsData() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        try {
            return JSON.parse(raw);
        } catch {
            return {};
        }
    }

    function saveAllFieldsData(allData) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
    }

    function clearAllSavedData() {
        localStorage.removeItem(STORAGE_KEY);
        updateLoggedUI({});
        updateMatchUI([]);
        alert('All saved Pok√©mon data cleared.');
    }

    function clearFieldData(fieldName) {
        const allData = loadAllFieldsData();
        if (allData[fieldName]) {
            delete allData[fieldName];
            saveAllFieldsData(allData);
            updateLoggedUI(allData);
            alert(`Saved data for field "${fieldName}" cleared.`);
        }
    }

    function createUI() {
        let panel = document.getElementById('pfq-match-panel');
        if (!panel) {
            panel = document.createElement('div');
            panel.id = 'pfq-match-panel';
            panel.style.position = 'fixed';
            panel.style.left = '0';
            panel.style.top = '100px';
            panel.style.width = '600px';
            panel.style.height = '600px';
            panel.style.overflow = 'auto';
            panel.style.zIndex = '9999';
            panel.style.background = 'rgba(0,0,0,0.85)';
            panel.style.color = 'white';
            panel.style.padding = '10px';
            panel.style.fontSize = '14px';
            panel.style.fontFamily = 'sans-serif';
            panel.style.borderRight = '3px solid #888';

            panel.innerHTML = `
                <h2 style="margin-top:0;">Matched Pok√©mon</h2>
                <div id="pfq-match-content"></div>
                <hr>
                <details style="margin-top:10px;">
                    <summary style="cursor:pointer;font-size:16px;">Show Saved Pok√©mon (Your Own Fields)</summary>
                    <div id="pfq-logged-pokemon" style="margin-top:10px; max-height:250px; overflow:auto;"></div>
                </details>
                <button id="pfq-clear-all" style="margin-top:10px; padding:6px 10px; cursor:pointer;">Clear All Saved Data</button>
            `;
            document.body.appendChild(panel);

            document.getElementById('pfq-clear-all').addEventListener('click', clearAllSavedData);
        }
    }

    function updateMatchUI(matches) {
        const container = document.getElementById('pfq-match-content');
        if (!container) return;

        container.innerHTML = '';

        if (matches.length === 0) {
            container.innerHTML = '<p>No matches found.</p>';
            return;
        }

        matches.forEach(({ yourMatch, otherFieldMon }, i) => {
            const entry = document.createElement('div');
            entry.style.marginBottom = '10px';
            entry.style.borderBottom = '1px solid #ccc';
            entry.style.paddingBottom = '6px';

            entry.innerHTML = `
                <div><strong>${i + 1}.</strong> <span style="color:#90ee90">${yourMatch.species}</span></div>
                <div><strong>Your Mon:</strong> ${yourMatch.nature} ‚Ä¢ ${yourMatch.forme || "Default"} ‚Ä¢ ${yourMatch.gender} ‚Ä¢ <a href="${yourMatch.link}" target="_blank" style="color:lightblue;">Link</a></div>
                <div><strong>Other's Mon:</strong> ${otherFieldMon.nature} ‚Ä¢ ${otherFieldMon.forme || "Default"} ‚Ä¢ ${otherFieldMon.gender} ‚Ä¢ <a href="${otherFieldMon.link}" target="_blank" style="color:lightblue;">Link</a></div>
            `;
            container.appendChild(entry);
        });
    }

    function updateLoggedUI(allSavedData) {
        const logContainer = document.getElementById('pfq-logged-pokemon');
        if (!logContainer) return;

        logContainer.innerHTML = '';

        const fieldNames = Object.keys(allSavedData);
        if (fieldNames.length === 0) {
            logContainer.innerHTML = '<p>No saved Pok√©mon data.</p>';
            return;
        }

        fieldNames.forEach(fieldName => {
            const mons = allSavedData[fieldName];

            const fieldDiv = document.createElement('div');
            fieldDiv.style.marginTop = '10px';
            fieldDiv.style.marginBottom = '6px';

            const headerDiv = document.createElement('div');
            headerDiv.style.fontWeight = 'bold';
            headerDiv.style.display = 'flex';
            headerDiv.style.alignItems = 'center';
            headerDiv.style.justifyContent = 'space-between';

            const titleSpan = document.createElement('span');
            titleSpan.textContent = `Field: ${fieldName} (${mons.length} Pok√©mon)`;

            const clearBtn = document.createElement('button');
            clearBtn.textContent = 'Clear';
            clearBtn.style.marginLeft = '10px';
            clearBtn.style.padding = '2px 6px';
            clearBtn.style.fontSize = '12px';
            clearBtn.style.cursor = 'pointer';
            clearBtn.style.backgroundColor = '#c33';
            clearBtn.style.color = 'white';
            clearBtn.style.border = 'none';
            clearBtn.style.borderRadius = '3px';

            clearBtn.addEventListener('click', () => {
                if (confirm(`Are you sure you want to clear saved data for the field "${fieldName}"?`)) {
                    clearFieldData(fieldName);
                }
            });

            headerDiv.appendChild(titleSpan);
            headerDiv.appendChild(clearBtn);

            fieldDiv.appendChild(headerDiv);

            mons.forEach((mon) => {
                const line = document.createElement('div');
                line.style.marginLeft = '10px';
                line.style.marginBottom = '4px';

                line.innerHTML = `Species: ${mon.species}, Gender: ${mon.gender || "N/A"}, Nature: ${mon.nature}, Forme: ${mon.forme || "Default"}, Link: <a href="${mon.link}" target="_blank" style="color:lightblue;">Link</a>`;
                fieldDiv.appendChild(line);
            });

            logContainer.appendChild(fieldDiv);
        });
    }

    function parseTooltipsAndCompare() {
        const currentFieldName = getCurrentFieldName();

        const IGNORED_FIELDS = [
            "Release 1",
            "Release 2",
            "Keep",
            "Utility",
            "5 IV Spares",
            "6 IV Spares"
        ];

        if (IGNORED_FIELDS.includes(currentFieldName)) {
            console.log(`[PFQ] Field "${currentFieldName}" is ignored, not logging data.`);
            return;
        }

    const allTooltips = document.querySelectorAll('.fieldmontip');
    const tooltips = [...allTooltips].filter(tip => !tip.closest('#field_party'));

    const parsed = [];

    tooltips.forEach(tooltip => {
        if (isOwnField && tooltip.textContent.includes('ü©∑')) return;

        const mon = getPokemonDataFromTooltip(tooltip);
        if (mon.species) parsed.push(mon);
        });

        const allSavedData = loadAllFieldsData();

        if (isOwnField) {
            allSavedData[currentFieldName] = parsed;
            saveAllFieldsData(allSavedData);
            updateLoggedUI(allSavedData);
            console.log(`[PFQ] Saved ${parsed.length} Pok√©mon from your field: "${currentFieldName}".`);
        } else {

            const combinedSavedMons = Object.values(allSavedData).flat();

            const matches = parsed.map(mon => {
                const match = matchPokemon(mon, combinedSavedMons);
                return match ? { yourMatch: match, otherFieldMon: mon } : null;
            }).filter(Boolean);

            updateMatchUI(matches);
        }
    }

    function init() {
        createUI();
        triggerTooltips();

        setTimeout(() => {
            parseTooltipsAndCompare();
        }, 2000);
    }

    window.addEventListener('load', () => {
        setTimeout(init, 1000);
    });
})();
